
<!-- Button trigger modal -->
<div class="btn btn-edit btn-xs" data-toggle="modal" data-target="#myModalEditLOI_<%=loi.id %>">
  <i class="fa fa-edit"></i>
</div>

<!-- Modal -->
<div class="modal fade" id="myModalEditLOI_<%=loi.id %>" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">Edit <%= loi.deal.name %> LOI Details</h4>
      </div>
      <div class="modal-body">



<% if loi.errors.any? %>
  <% loi.errors.full_messages.each do |message| %>
    <div class="alert alert-dismissable alert-danger">
      <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
      <%= message %>
    </div>
  <% end %>
<% end %>

<!-- Responsive panel example -->

<div class="row">
  <div class="col-lg-12">

        <form id="loi_elements" class="form-horizontal">
          <!-- Hidden input for authenticity token to protect from forgery -->
          <input id="authenticity_token" type="hidden" value="<%= form_authenticity_token %>">

          <!-- Label and input for name -->
          <div class="form-group">
            <label for="name" class="col-lg-2 control-label">
              LOI Document Title
            </label>
            <div class="col-lg-10">
              <input type="string" id="name" name="name" placeholder="e.g., Company Name / Acquirer Name loi" class="form-control" value="<%= loi.name %>">
            </div>
          </div>

          <!-- Label and input for Deal Name -->
          <div class="form-group">
            <label for="name" class="col-lg-2 control-label">
              Deal
            </label>
            <div class="col-lg-10">
              <%= select_tag :deal_id, options_from_collection_for_select(Deal.all, :id, :name, loi.deal_id), :class => "form-control" %>
            </div>
          </div>
          <!-- Label and input for LOI Date -->
          <div class="form-group">
            <label for="loi_date" class="col-lg-2 control-label">
              LOI Date
            </label>
            <div class="col-lg-10">
              <input type="date" id="loi_date" name="loi_date" placeholder="e.g., 09/09/2017" class="form-control" value="<%= Date.current %>">
            </div>
          </div>

          <input type="hidden" id="image_id" value="<%= loi.image_id %>">

          <!-- Update each highlight -->
          <% loi.loi_highlights.order("highlight_id asc").each do |loi_highlight| %>
              <div class="form-group">
                <label for="<%=loi_highlight.id%>" class="col-sm-2 control-label">
                  <%= loi_highlight.highlight.name%>:
                </label>
                <div class="col-sm-10">
                  <textarea id="<%=loi_highlight.id%>"  class="form-control" rows="3"><%= loi_highlight.detail %></textarea>
                </div>
              </div> 
          <% end %>

          <!-- Label and input for Enterprise Value ($ millions) -->
          <div class="form-group">
            <label for="enterprise_value" class="col-sm-2 control-label">
              Enterprise Value ($ millions)
            </label>
            <div class="col-sm-10">
              <input type="string" id="enterprise_value" name="enterprise_value" placeholder="10.1" class="form-control" value="<%= loi.enterprise_value %>">
            </div>
          </div>



          <div class="form-group">
            <div class="col-lg-offset-2 col-lg-3">
              <button class="btn btn-lincoln">
                Update LOI
              </button>
              or
              <a href="/lois/<%= loi.id %>">Cancel</a>
            </div>
          </div>
        </form>

  </div>
</div>


      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<script>
$('#loi_elements').submit(function() {
    // get all the inputs into an array.
    var $inputs = $('#loi_elements :input');

    var ids = [];
    var details = [];
    var i =0;
    $inputs.each(function() {
        ids[i] = $(this).attr("id");
        details[i] = $(this).val();
        i=i+1;
    });


    $.post("/update_loi_and_highlights/",
     {'authenticity_token':details[0],
      'loi_id':<%=loi.id%>,
      'ids[]':ids,
      'details[]': details
     });
});
</script>
